const TOOL_CATALOG = [
    {
        name: 'exiftool',
        category: 'Document File Analysis',
        platform: 'cross-platform',
        command: 'exiftool <file>',
        description: 'Extract metadata from suspicious documents and attachments.',
        link: ''
    },
    {
        name: 'md5sum',
        category: 'Document File Analysis',
        platform: 'linux',
        command: 'md5sum <file>',
        description: 'Generate and verify checksums for integrity tracking.',
        link: ''
    },
    {
        name: 'olevba',
        category: 'Document File Analysis',
        platform: 'cross-platform',
        command: 'olevba <file> > extracted.vba',
        description: 'Extract embedded VBA macro code from OLE documents.',
        link: ''
    },
    {
        name: 'olevba (deobfuscate)',
        category: 'Document File Analysis',
        platform: 'cross-platform',
        command: 'olevba --deobf --reveal extracted.vba > cleaned.vba',
        description: 'Deobfuscate macro logic for readable analysis.',
        link: ''
    },
    {
        name: 'vmonkey',
        category: 'Document File Analysis',
        platform: 'cross-platform',
        command: 'vmonkey cleaned.vba',
        description: 'Emulate and analyze VBA execution behavior.',
        link: ''
    },
    {
        name: 'oleid',
        category: 'Document File Analysis',
        platform: 'cross-platform',
        command: 'oleid <file>',
        description: 'Detect potentially malicious OLE objects quickly.',
        link: ''
    },
    {
        name: 'olemeta',
        category: 'Document File Analysis',
        platform: 'cross-platform',
        command: 'olemeta <file>',
        description: 'Inspect OLE metadata similar to document triage workflows.',
        link: ''
    },
    {
        name: 'Hybrid Analysis',
        category: 'Document File Analysis',
        platform: 'web',
        command: '',
        description: 'Online malware analysis sandbox for behavioral scanning.',
        link: 'https://www.hybrid-analysis.com'
    },
    {
        name: 'ILSpy',
        category: '.NET Decompilers',
        platform: 'cross-platform',
        command: '',
        description: 'Open-source .NET assembly browser and decompiler.',
        link: 'https://github.com/icsharpcode/ILSpy'
    },
    {
        name: 'dotPeek',
        category: '.NET Decompilers',
        platform: 'windows',
        command: '',
        description: 'JetBrains decompiler for .NET binaries.',
        link: 'https://www.jetbrains.com/decompiler/'
    },
    {
        name: '.NET Reflector',
        category: '.NET Decompilers',
        platform: 'windows',
        command: '',
        description: 'Commercial .NET decompiler toolset.',
        link: 'https://www.red-gate.com/products/dotnet-development/reflector/'
    },
    {
        name: 'JustDecompile',
        category: '.NET Decompilers',
        platform: 'windows',
        command: '',
        description: 'Decompiler engine for analyzing .NET binaries.',
        link: 'https://github.com/telerik/justdecompileengine'
    },
    {
        name: 'IDA Pro',
        category: 'Disassemblers',
        platform: 'cross-platform',
        command: '',
        description: 'Industry-grade disassembler and reverse engineering suite.',
        link: 'https://www.hex-rays.com/ida-pro/'
    },
    {
        name: 'Hopper Disassembler',
        category: 'Disassemblers',
        platform: 'linux',
        command: '',
        description: 'Disassembler for binary analysis and reverse engineering.',
        link: 'https://www.hopperapp.com/'
    },
    {
        name: 'Binary Ninja',
        category: 'Disassemblers',
        platform: 'cross-platform',
        command: '',
        description: 'Modern binary analysis platform for static reversing.',
        link: 'https://binary.ninja/'
    },
    {
        name: 'objdump',
        category: 'Disassemblers',
        platform: 'linux',
        command: 'objdump -d <binary>',
        description: 'CLI utility to disassemble executables and libraries.',
        link: 'https://man7.org/linux/man-pages/man1/objdump.1.html'
    },
    {
        name: 'OllyDbg',
        category: 'Debuggers',
        platform: 'windows',
        command: '',
        description: 'Classic Windows user-mode debugger.',
        link: 'https://www.ollydbg.de/'
    },
    {
        name: 'Immunity Debugger',
        category: 'Debuggers',
        platform: 'windows',
        command: '',
        description: 'Windows debugger with scripting for exploit analysis.',
        link: 'https://www.immunityinc.com/products/debugger/'
    },
    {
        name: 'GDB',
        category: 'Debuggers',
        platform: 'linux',
        command: 'gdb <binary>',
        description: 'GNU debugger for stepping through binary execution.',
        link: 'https://www.sourceware.org/gdb/'
    },
    {
        name: 'IDA Pro Debugger',
        category: 'Debuggers',
        platform: 'cross-platform',
        command: '',
        description: 'Integrated debugger inside IDA Pro.',
        link: 'https://hex-rays.com/ida-pro/'
    },
    {
        name: 'x64dbg',
        category: 'Debuggers',
        platform: 'windows',
        command: '',
        description: 'Open-source debugger for 64-bit and 32-bit Windows binaries.',
        link: 'https://x64dbg.com/'
    },
    {
        name: 'WinDbg',
        category: 'Debuggers',
        platform: 'windows',
        command: '',
        description: 'Microsoft debugger for user-mode and kernel-mode analysis.',
        link: 'https://learn.microsoft.com/en-us/windows-hardware/drivers/debugger/debugger-download-tools'
    }
];

const ui = {};
const state = {
    items: TOOL_CATALOG,
    filtered: TOOL_CATALOG
};

function init() {
    cacheDom();
    bindEvents();
    fillCategoryOptions();
    renderTools();
    initCursorEffects();
    applyBackgroundParallax(window.scrollY || 0);
}

function cacheDom() {
    ui.menuToggle = document.getElementById('menuToggle');
    ui.navLinks = document.getElementById('navLinks');
    ui.backToTop = document.getElementById('backToTop');
    ui.toolSearch = document.getElementById('toolSearch');
    ui.toolCategory = document.getElementById('toolCategory');
    ui.toolPlatform = document.getElementById('toolPlatform');
    ui.toolMeta = document.getElementById('toolMeta');
    ui.toolGrid = document.getElementById('toolGrid');
}

function bindEvents() {
    if (ui.menuToggle && ui.navLinks) {
        ui.menuToggle.addEventListener('click', () => ui.navLinks.classList.toggle('open'));
        ui.navLinks.querySelectorAll('a').forEach((link) => {
            link.addEventListener('click', () => ui.navLinks.classList.remove('open'));
        });
    }

    if (ui.backToTop) {
        window.addEventListener('scroll', () => {
            const y = window.scrollY || 0;
            if (y > 480) ui.backToTop.classList.add('visible');
            else ui.backToTop.classList.remove('visible');
            applyBackgroundParallax(y);
        });
        ui.backToTop.addEventListener('click', () => window.scrollTo({ top: 0, behavior: 'smooth' }));
    }

    ui.toolSearch.addEventListener('input', renderTools);
    ui.toolCategory.addEventListener('change', renderTools);
    ui.toolPlatform.addEventListener('change', renderTools);
}

function fillCategoryOptions() {
    const categories = [...new Set(state.items.map((item) => item.category))].sort((a, b) => a.localeCompare(b));
    categories.forEach((category) => {
        const option = document.createElement('option');
        option.value = category;
        option.textContent = category;
        ui.toolCategory.appendChild(option);
    });
}

function renderTools() {
    const search = ui.toolSearch.value.trim().toLowerCase();
    const category = ui.toolCategory.value;
    const platform = ui.toolPlatform.value;

    let list = [...state.items];

    if (category !== 'all') list = list.filter((item) => item.category === category);
    if (platform !== 'all') list = list.filter((item) => item.platform === platform);
    if (search) {
        list = list.filter((item) => `${item.name} ${item.category} ${item.command} ${item.description}`.toLowerCase().includes(search));
    }

    state.filtered = list;
    ui.toolMeta.textContent = `${list.length} tool(s) shown from ${state.items.length} total.`;
    ui.toolGrid.innerHTML = '';

    if (!list.length) {
        ui.toolGrid.innerHTML = '<article class="empty-state">No tools matched your current filter.</article>';
        return;
    }

    list.forEach((item) => {
        const card = document.createElement('article');
        card.className = 'tool-card';
        card.innerHTML = `
            <header class="tool-head">
                <h3>${escapeHtml(item.name)}</h3>
                <span class="category-pill">${escapeHtml(item.platform)}</span>
            </header>
            <p class="tool-category">${escapeHtml(item.category)}</p>
            <p class="tool-desc">${escapeHtml(item.description)}</p>
            ${item.command ? `<pre><code>${escapeHtml(item.command)}</code></pre>` : ''}
            <footer class="tool-actions">
                ${item.command ? '<button class="btn btn-ghost btn-copy" type="button">Copy command</button>' : '<span></span>'}
                ${item.link ? `<a class="btn btn-secondary" href="${escapeHtml(item.link)}" target="_blank" rel="noopener">Open link</a>` : ''}
            </footer>
        `;

        const copyButton = card.querySelector('.btn-copy');
        if (copyButton) {
            copyButton.addEventListener('click', async () => {
                try {
                    await navigator.clipboard.writeText(item.command);
                    copyButton.textContent = 'Copied';
                    setTimeout(() => { copyButton.textContent = 'Copy command'; }, 1000);
                } catch {
                    copyButton.textContent = 'Copy failed';
                    setTimeout(() => { copyButton.textContent = 'Copy command'; }, 1000);
                }
            });
        }

        ui.toolGrid.appendChild(card);
    });
}

function escapeHtml(value) {
    return String(value)
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;')
        .replace(/"/g, '&quot;')
        .replace(/'/g, '&#39;');
}

function applyBackgroundParallax(scrollY) {
    const root = document.documentElement;
    const y = Number(scrollY) || 0;
    root.style.setProperty('--parallax-shift', `${Math.max(-90, y * -0.08)}px`);
    root.style.setProperty('--parallax-video', `${Math.max(-160, y * -0.12)}px`);
    root.style.setProperty('--parallax-orb-a', `${Math.max(-120, y * -0.06)}px`);
    root.style.setProperty('--parallax-orb-b', `${Math.max(-200, y * -0.14)}px`);
}

function initCursorEffects() {
    if (window.matchMedia('(pointer: coarse)').matches) return;

    const ring = document.getElementById('cursorRing');
    const dot = document.getElementById('cursorDot');
    if (!ring || !dot) return;

    let mouseX = window.innerWidth / 2;
    let mouseY = window.innerHeight / 2;
    let ringX = mouseX;
    let ringY = mouseY;

    const animate = () => {
        ringX += (mouseX - ringX) * 0.18;
        ringY += (mouseY - ringY) * 0.18;
        dot.style.transform = `translate(${mouseX}px, ${mouseY}px) translate(-50%, -50%)`;
        ring.style.transform = `translate(${ringX}px, ${ringY}px) translate(-50%, -50%)`;
        requestAnimationFrame(animate);
    };

    document.body.classList.add('cursor-active');
    requestAnimationFrame(animate);

    window.addEventListener('mousemove', (event) => {
        mouseX = event.clientX;
        mouseY = event.clientY;
    });

    document.addEventListener('mouseover', (event) => {
        if (event.target.closest('a, button, input, select, textarea, .tool-card')) {
            document.body.classList.add('cursor-hover');
        }
    });

    document.addEventListener('mouseout', (event) => {
        if (event.target.closest('a, button, input, select, textarea, .tool-card')) {
            document.body.classList.remove('cursor-hover');
        }
    });

    window.addEventListener('mousedown', () => document.body.classList.add('cursor-down'));
    window.addEventListener('mouseup', () => document.body.classList.remove('cursor-down'));
    window.addEventListener('blur', () => document.body.classList.remove('cursor-hover', 'cursor-down'));
}

document.addEventListener('DOMContentLoaded', init);
